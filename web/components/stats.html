<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ShareTrace</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <script src="../lib/echarts.min.js"></script>
    <script src="../lib/fetch.js"></script>
    <script src="../lib/jquery-2.1.4.min.js"></script>
    <script src="../js/utils.js"></script>
    <style>

    </style>
</head>
<body>


<div id="main" style="width: 600px;height:400px;"></div>
<script type="text/javascript">
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('main'));

        // 指定图表的配置项和数据

    var url_vars = $.getUrlVars();                                           
    var appid=url_vars["appid"];
    var ret_data;
    var legend_data = new Array();
    var xAxis_data = new Array();
    var series_data = new Array();
    var url = "/1/stats/total?appid=" + appid;
    fetch(url, {
        method: 'get',
        credentials: 'same-origin'
    }).then(function (response) {
        return response.json();
    }).then(function (data) {
        if (isEmpty(data)){
            alert("No data");
        }
    	ret_data = data;
    	for (var key in ret_data.data) {
            legend_data.push(key);
            var series_line = {};
            series_line["name"] = key;
            series_line["type"] = "line";
            //series_line["stack"] = "总量";
            series_line["data"] = new Array();
            for (var key2 in ret_data.data[key]){
            	series_line["data"].push(ret_data.data[key][key2]);
            }
            //console.log(series_line);
            series_data.push(series_line);
        }
        //console.log(series_data);
        for (var key in ret_data.data["share"]){
        	xAxis_data.push(key);
        }


option = {
    tooltip : {
        trigger: 'axis'
    },
    legend: {
        data:legend_data
    },
    grid: {
        left: '3%',
        right: '4%',
        bottom: '3%',
        containLabel: true
    },
    toolbox: {
        feature: {
            saveAsImage: {}
        }
    },
    xAxis : [
        {
            type : 'category',
            boundaryGap : false,
            data:xAxis_data
        }
    ],
    yAxis : [
        {
            type : 'value'
        }
    ],
    series: series_data
    //series : [
    //    {
    //        name:'share',
    //        type:'line',
    //        stack: '总量',
    //        data:[120, 132, 101, 134, 90, 230, 210]
    //    },
    //    {
    //        name:'click',
    //        type:'line',
    //        stack: '总量',
    //        data:[220, 182, 191, 234, 290, 330, 310]
    //    },
    //    {
    //        name:'install',
    //        type:'line',
    //        stack: '总量',
    //        data:[150, 232, 201, 154, 190, 330, 410]
    //    },
    //]
};

//console.log(option["series"]);
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
    });
    </script>


</body>
</html>
